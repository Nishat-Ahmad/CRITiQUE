{% extends 'base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto py-12 px-6">
  
  <div class="flex items-center justify-between mb-12">
    <div>
      <h1 style="color: orange" class="font-serif text-4xl font-bold text-stone-900">Admin Dashboard</h1>
      <p class="text-stone-500 mt-1">System metrics and moderation.</p>
    </div>
    <span class="bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest">
      Superuser Mode
    </span>
  </div>

  {% if error %}
    <div class="bg-red-50 border-l-4 border-red-500 p-4 text-red-700 font-bold rounded">
      {{ error }}
    </div>
  {% else %}

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 cursor-help" title="Unique users who posted a review in the last 24 hours.">
        <div class="text-xs font-bold uppercase text-stone-400 mb-2">Active Users (24h)</div>
        <div class="text-4xl font-serif font-bold text-stone-900">
          {{ activeUsersToday if activeUsersToday is not none else '-' }}
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 cursor-help" title="Percentage of registered users who have posted at least one review.">
        <div class="text-xs font-bold uppercase text-stone-400 mb-2">Contributor Conversion</div>
        <div class="text-4xl font-serif font-bold text-stone-900">
           {{ '%.0f'|format(contributorConversion) }}<span class="text-xl text-stone-400">%</span>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 cursor-help" title="Percentage of contributors who returned to post a second review.">
        <div class="text-xs font-bold uppercase text-stone-400 mb-2">User Retention</div>
        <div class="text-4xl font-serif font-bold text-stone-900">18<span class="text-xl text-stone-400">%</span>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 cursor-help" title="Week-over-week growth in total review volume.">
        <div class="text-xs font-bold uppercase text-stone-400 mb-2">Growth Velocity (WoW)</div>
        <div class="text-4xl font-serif font-bold text-stone-900 {{ 'text-green-500' if growthVelocity > 0 else 'text-red-500' }}">
           {{ '+' if growthVelocity > 0 }}{{ '%.0f'|format(growthVelocity) }}<span class="text-xl text-stone-400">%</span>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <div class="lg:col-span-2 bg-white p-8 rounded-3xl shadow-sm border border-stone-100">
        <h3 class="font-serif text-xl font-bold text-stone-900 mb-6">Review Velocity</h3>
        <div class="bg-stone-50 rounded-xl p-4 overflow-hidden flex items-center justify-center">
          <img src="/chart/reviews.png" alt="Reviews per day chart" class="max-w-full h-auto mix-blend-multiply" />
        </div>
      </div>

      <div class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 flex flex-col h-full">
        <h3 class="font-serif text-xl font-bold text-stone-900 mb-6">Place Health</h3>
        
        {% if averageRatingPerPlace %}
          <div class="overflow-y-auto max-h-96 pr-2 space-y-4">
            {% for p in averageRatingPerPlace %}
              <div class="flex items-center justify-between p-3 rounded-xl hover:bg-stone-50 transition-colors">
                <div class="overflow-hidden">
                  <div class="font-bold text-stone-800 truncate">{{ p.name }}</div>
                  <div class="text-xs text-stone-400">{{ p.count }} reviews</div>
                </div>
                <div class="flex items-center gap-1 bg-stone-100 px-2 py-1 rounded text-stone-700 font-bold text-sm">
                  <span>â˜…</span>
                  <span>{{ '%.1f'|format(p.avgRating) }}</span>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-stone-400 italic">No ratings yet.</p>
        {% endif %}
      </div>
    </div>

  {% endif %}
</div>
{% endblock %}